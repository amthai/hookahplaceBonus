# Настройка PostgreSQL для Vercel

## Проблема
После каждого деплоя на Vercel база данных обнуляется, потому что `/tmp` очищается.

## Решение
Переходим на Vercel Postgres - постоянную базу данных.

## Шаги настройки

### 1. Создание PostgreSQL базы на Vercel

1. Зайдите в [Vercel Dashboard](https://vercel.com/dashboard)
2. Выберите ваш проект
3. Перейдите в раздел **Storage**
4. Нажмите **Create Database**
5. Выберите **Postgres**
6. Дайте имя базе (например: `hookahplace-db`)
7. Выберите регион (ближайший к вашим пользователям)
8. Нажмите **Create**

### 2. Получение connection string

После создания базы:
1. Перейдите в раздел **Storage** → ваша база
2. Скопируйте **Connection String**
3. Добавьте его в Environment Variables проекта:
   - Variable: `POSTGRES_URL`
   - Value: ваш connection string

### 3. Установка зависимостей

```bash
npm install pg
```

### 4. Деплой

После настройки переменной окружения:
```bash
git add .
git commit -m "Add PostgreSQL support"
git push
```

## Проверка работы

После деплоя проверьте:
1. `/api/debug` - должен показать `databaseType: "PostgreSQL"`
2. Создайте пользователя через API
3. Отметьте посещение
4. Проверьте, что данные сохраняются после редеплоя

## Локальная разработка

Для локальной разработки PostgreSQL не требуется - будет использоваться SimpleDB.

## Миграция данных

Если у вас уже есть данные в старой системе, их нужно будет перенести вручную или создать скрипт миграции.

## Структура таблиц

Автоматически создаются таблицы:
- `users` - пользователи
- `visits` - посещения  
- `bonuses` - бонусы

Все связи настроены через foreign keys.
